/* ============ Base ============ */
* { box-sizing: border-box; }
html, body { overflow-x: hidden; height: 100%; }
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans TC',sans-serif;
  background:#1C6F73;
  color:#fff;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
.screen{ display:none; min-height:100vh; padding:12px; }
.screen.active{ display:block; }

/* ============ Topbar ============ */
.topbar{
  display:flex; align-items:center; gap:8px;
}
.topbar h1{
  flex:1; text-align:center; font-size:28px; font-weight:800;
  margin:12px 0; letter-spacing:1px;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.nav-btn{ background:transparent; border:none; padding:6px; border-radius:10px; -webkit-tap-highlight-color:transparent; }

/* Puzzle header（左返回｜中進度｜右排行榜） */
.puzzle-topbar{
  position:relative; display:grid; grid-template-columns:48px 1fr 48px;
  align-items:center; padding-top:8px;
}
.topbar-center{ display:flex; align-items:center; justify-content:center; font-weight:800; font-size:18px; letter-spacing:.5px; }

/* ============ Cover ============ */
.cover-top img{ display:block; max-width:720px; width:100%; margin:0 auto; border-radius:12px; }
.cover-form{ display:flex; flex-direction:column; gap:12px; max-width:420px; margin:18px auto 0; }
.cover-form input{
  padding:12px 14px; border-radius:10px; border:2px solid #eae6da; font-size:18px; -webkit-tap-highlight-color:transparent;
}
.cover-form button{
  padding:12px; border:none; border-radius:10px; background:#eae6da; color:#114a4d; font-weight:700; font-size:18px; -webkit-tap-highlight-color:transparent;
}

/* ============ Level List ============ */
/* 名稱靠左｜右側依序：徽章圓、箭頭圓；標題單行，進度可縮小 */
.level-list{
  list-style:none; padding:0; margin:16px auto 12px; max-width:720px;
  display:flex; flex-direction:column; gap:16px;
}
.level-pill{
  display:grid; grid-template-columns:1fr 56px 56px; /* 左(名稱+進度) | 徽章 | 箭頭 */
  align-items:center; gap:14px;
  background:#e7ecdf; color:#114a4d;
  border-radius:24px; padding:18px 18px 18px 24px;
  border:2px solid rgba(234,230,218,.9);
  box-shadow:0 1px 0 rgba(0,0,0,.03) inset;
}
.level-left{
  display:flex; align-items:center; justify-content:space-between;
  gap:12px; min-width:0; flex-wrap:nowrap;
}
/* 標題：永遠單行、不縮、不省略（桌機28px；手機24px） */
.level-title{
  flex:1 1 auto; min-width:0;
  white-space:nowrap; overflow:visible; text-overflow:clip;
  font-size:28px; font-weight:900; letter-spacing:1px;
}
/* 進度：只在窄螢幕縮小／變窄，不擠到徽章 */
.level-progress{
  flex:0 0 auto; text-align:right; white-space:nowrap;
  font-size:18px; font-weight:700; opacity:.85;
  font-variant-numeric: tabular-nums; font-feature-settings:"tnum";
  min-width:60px; max-width:clamp(72px, 22vw, 110px);
  transform-origin:right center; transition:transform .2s ease;
}
/* 徽章＆箭頭固定尺寸，避免被擠 */
.badge-circle, .enter-circle {
  width:56px; height:56px; flex:0 0 56px;
  border-radius:50%;
  display:flex; align-items:center; justify-content:center;
}

/* ✅ 外圈：保持圓形並裁切邊緣 */
.badge-circle {
  background: rgba(17,74,77,.08);
  overflow: hidden;                /* 重要：讓內圖完全貼齊外圈 */
}

/* ✅ 內圖：填滿外圈，不再固定36px */
.badge-circle img {
  width:100%;                      /* 改成百分比 */
  height:100%;
  border-radius:50%;               /* 讓內外皆為圓形 */
  object-fit:cover;                /* 讓圖片鋪滿不變形 */
  display:block;                   /* 消除img預設空隙 */
  opacity:.9;
  pointer-events:none;
}

/* ✅ 箭頭保持原樣 */
.enter-circle {
  border:none;
  background:rgba(17,74,77,.15);
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
}
.enter-circle img {
  width:26px; height:26px;
  pointer-events:none;
}


/* Level List - 小螢幕微調 */
@media (max-width: 480px){
  .level-left{ gap:8px; }
  .level-progress{ font-size:clamp(12px, 3.8vw, 18px); transform:scaleX(.9); }
}
@media (max-width: 420px){
  .level-title{ font-size:24px; }
  .level-progress{ font-size:16px; }
  .badge-circle, .enter-circle{ width:52px; height:52px; flex-basis:52px; }
  /* 小螢幕徽章圖依然填滿整個圓 */
  .enter-circle img{ width:24px; height:24px; }
}

/* ============ Puzzle ============ */
.puzzle-title{ text-align:center; font-size:32px; font-weight:900; margin:8px 0 6px; }

.board-wrap{
  display:flex; justify-content:center; margin:8px 0 10px;
  overflow:visible; padding-inline:8px; max-width:100dvw; touch-action:none;
}
#board{
  display:block; max-width:100%; background:#F7F7F7; border-radius:12px;
  box-shadow:0 0 0 10px #eae6da inset;
  touch-action:none; -webkit-tap-highlight-color:transparent;
  user-select:none; cursor:pointer;
}
.toolbar{
  display:flex; justify-content:center; gap:8px; flex-wrap:wrap; margin:6px 0 10px; user-select:none;
}
.toolbar .tool{
  background:#fff; border:2px solid #eae6da; border-radius:10px; padding:6px; outline:none; -webkit-tap-highlight-color:transparent;
}
.toolbar img{ height:40px; pointer-events:none; }
.tool.active{
  border-color:#114a4d;
  box-shadow:0 0 0 4px rgba(255,255,255,.95) inset, 0 0 0 3px #114a4d;
  transform:translateY(-1px);
}
/* 可選：若不需要厚邊框就刪掉下一行 */
.toolbar .tool{ border:10px solid #eae6da; }

.puzzle-footer{
  display:flex; align-items:center; justify-content:center; gap:18px; margin:12px 0 24px; -webkit-tap-highlight-color:transparent;
}
.pill{
  background:#fff; color:#114a4d; border:2px solid #eae6da; border-radius:999px; padding:8px 14px; font-weight:800; user-select:none;
}
.status-small{ width:42px; height:42px; display:block; pointer-events:none; }

/* ============ Badges ============ */
.badge-wrap{ display:flex; justify-content:center; margin:20px 0; }
.badge-wrap img{
  max-width:80vw; max-height:70vh; height:auto; object-fit:contain;
}

/* ============ Leaderboard（簡潔版：名稱 + 總完成） ============ */
.leaderboard{
  max-width:640px; margin:0 auto; background:#155f63;
  border:2px solid #eae6da; border-radius:16px; padding:8px 10px;
}
#leaderboardList{ display:flex; flex-direction:column; gap:10px; padding:0 2px; }
.lb-row{
  display:grid; grid-template-columns:32px 1fr auto; /* 排名 | 名稱 | x/100 */
  align-items:center; gap:10px; padding:10px 12px;
  border-bottom:1px solid rgba(234,230,218,.6);
}
.lb-row:last-child{ border-bottom:none; }
.lb-name{ font-weight:700; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.lb-total{
  background:#fff; color:#114a4d; font-weight:800;
  border:2px solid #eae6da; border-radius:999px;
  padding:4px 10px; min-width:90px; text-align:center;
}
/* 隱藏舊版 5 關進度條區 */
#screen-leaderboard .lb-bars{ display:none !important; }

/* Leaderboard 頁面的 Topbar 尺寸 */
#screen-leaderboard .topbar{
  display:flex; align-items:center; justify-content:space-between; padding:8px 10px;
}
#screen-leaderboard .topbar .nav-btn img{ width:28px; height:28px; display:block; pointer-events:none; }

/* Leaderboard - 小螢幕 */
@media (max-width: 420px){
  .leaderboard{ padding:6px 8px; }
  .lb-row{ gap:8px; padding:8px 10px; }
  .lb-total{ min-width:80px; padding:3px 8px; }
}

/* === 徽章頁 === */
#screen-badge{
  /* 不設定 display，讓 .screen 的 display:none 生效 */
  flex-direction: column;
  justify-content: space-between;
  align-items: center;
  min-height: 100vh;
  padding: 12px 0 28px;
  text-align: center;
}
#screen-badge.active{
  display: flex;             /* 只有啟用時才顯示 */
}

.badge-topbar{
  width:100%;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:8px 12px;
  position:relative;
  z-index:2;
}
.badge-topbar h1{
  flex:1;
  text-align:center;
  font-size:24px;
  font-weight:800;
  margin:0;
}
.badge-topbar .nav-btn img{
  width:28px; height:28px; display:block;
}

/* 合併後的徽章容器（刪掉上方舊的 .badge-wrap 定義以免重複） */
.badge-wrap{
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center;
  margin:16px 0;
}
.badge-wrap img{
  max-width:80vw;
  max-height:70vh;           /* 給比較寬鬆的高度避免小螢幕溢出 */
  border-radius:12px;
  background:#fff;
  object-fit:contain;
}

.badge-actions{
  display:flex;
  justify-content:center;
  align-items:center;
}
#btnBadgeNext.pill{
  background:#eae6da;
  color:#114a4d;
  border:none;
  border-radius:999px;
  padding:12px 26px;
  font-size:18px;
  font-weight:800;
  -webkit-tap-highlight-color:transparent;
}

